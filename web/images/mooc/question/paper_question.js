Teacher.paper.paper_question={typeCur:$(".current-type"),treeList:$(".tree-list"),questionList:$(".question-list"),typeOption:$(".type-list ul"),typeItem:$(".type-list a"),typeList:$(".type-list"),mainMenu:$(".child-menu"),filterLink:$(".filter-box a"),mainContent:$(".child-content .content-wrap"),init:function(){Teacher.paper.paper_question.page(1),Teacher.paper.paper_question.get_category(this.typeCur.data("cselect")),Teacher.paper.paper_common.randerQuestion=Teacher.paper.paper_question.randerQuestion,this.treeList.on("click",".item",function(){var this_a=this;Teacher.paper.paper_question.treeItemClick(this_a)}),this.questionList.on("click",".question-content",function(){var this_a=this;$(this_a).find(".answer").toggle()}),this.questionList.on("click",".all_in",function(event){var this_a=this;return event.stopPropagation(),Teacher.paper.paper_question.addQuestionsClick(this_a),!1}),this.questionList.on("click",".control-btn",function(){var this_a=this;Teacher.paper.paper_question.addQuestionClick(this_a)}),this.typeItem.click(function(){var this_a=this,thisText=$(this_a).text();$(this_a).parent().parent().siblings("a").children("span").text(thisText)}),this.typeOption.click(function(){Teacher.paper.paper_question.typeOption.hide()}),this.typeList.hover(function(){var this_a=this;$(this_a).children(".current-type").addClass("hover"),$(this_a).children("ul").children().length>0?$(this_a).children("ul").show():$(this_a).children("ul").hide()},function(){var this_a=this;$(this_a).children(".current-type").removeClass("hover"),$(this_a).children("ul").hide()}),this.filterLink.click(function(){var this_a=this;Teacher.paper.paper_question.filterQuestionClick(this_a)})},getUrlData:function(ele){ele=ele||1;var nselectVal=$(".tree-list .active").data()||{nselect:$(".current-type").data("cselect")},finalData=$.extend({page:ele},nselectVal,$(".current-type").data(),$(".filter-box .active").eq(0).data(),$(".filter-box .active").eq(1).data());return finalData},randerQuestion:function(){this_a=Teacher.paper.paper_question;var page_num=$(".page").find(".active").html(),urlData=this_a.getUrlData(page_num);this_a.get_question(urlData,!0)},treeItemClick:function(this_a){if($(this_a).hasClass("active"))return!1;this.treeList.find("a").removeClass("active"),$(this_a).addClass("active");var urlData=this.getUrlData();this.get_question(urlData)},treeListClick:function(this_a){var thisId=$(this_a).data("url_id"),thisClass=$(this_a).attr("class"),thisStatus=thisClass.split(" ")[1],thisChild=$(this_a).parent("div").siblings("ul"),statusText=thisStatus.split("-"),changeStatus=function(){return"plus"==statusText[1]?statusText[0]+"-subtract":"subtract"==statusText[1]?statusText[0]+"-plus":void 0};"plus"==statusText[1]&&0==thisChild.length&&this.get_category(thisId,$(this_a).parent("div")),"item"!=statusText[1]&&($(this_a).removeClass(thisStatus).addClass(changeStatus()),thisChild.toggle())},addQuestionClick:function(this_a){var qid=$(this_a).data("question_id"),sid=this.typeCur.data("sid"),qorigin=$(this_a).data("question_origin");void 0==qorigin&&(qorigin=paperQuestionOrigin);var category_id=$(this_a).data("category_id");void 0==category_id&&(category_id=0);var course_id=$(this_a).data("course_id");void 0==course_id&&(course_id=0);var qdata={qid:qid,sid:sid,qorigin:qorigin,category_id:category_id,course_id:course_id},index=$(".control-btn").index(this_a);$(this_a).children("span:visible").length>0?($(".control-btn").eq(index).removeClass("control-btn").addClass("control-btn-2"),this.add_question(qdata,index,function(){$(".control-btn-2").removeClass("control-btn-2").addClass("control-btn")})):($(".control-btn").eq(index).removeClass("control-btn").addClass("control-btn-2"),this.remove_question(qid,sid,qorigin,index,function(){$(".control-btn-2").removeClass("control-btn-2").addClass("control-btn")}))},addQuestionsClick:function(this_a){var sid=this.typeCur.data("sid"),index=$(".control-btn").index(this),qids=new Array;$(".question-list .question-box").each(function(index){var id=$(this).attr("data-question_id"),category_id=$(this).attr("data-category_id");void 0==category_id&&(category_id=0);var course_id=$(this).attr("data-course_id");void 0==course_id&&(course_id=0),qids[index]={id:id,category_id:category_id,course_id:course_id}});var qorigin=$(this_a).data("question_origin");void 0==qorigin&&(qorigin=paperQuestionOrigin);var qdata={qids:qids,sid:sid,qorigin:qorigin};$(".all_in").removeClass("all_in").addClass("all_in_2"),this.add_questions(qdata,index,function(){$(".all_in_2").removeClass("all_in_2").addClass("all_in")})},filterQuestionClick:function(this_a){if("active"==$(this_a).attr("class"))return!1;$(this_a).parents("ul").find("a").removeClass("active"),$(this_a).addClass("active");var urlData=this.getUrlData();this.get_question(urlData)},get_question:function(getData,noloading){1!=noloading&&($(".all_in").removeClass("all_in").addClass("all_in_2"),Common.floatLoading.showLoading()),getData.ver=(new Date).valueOf(),$.tizi_ajax({url:baseUrlName+"paper/paper_question/get_question",type:"GET",dataType:"json",data:getData,success:function(data){$(".all_in_2").removeClass("all_in_2").addClass("all_in"),Common.floatLoading.hideLoading(),1==data.errorcode?($(".question-list").html(data.html),$(".question-box").length<1?$(".all_in").hide():$(".all_in").show(),$(".mainContainer .content").css("height",$(".mainContainer .content").height()).css("overflow-y","scroll")):$(".child-content").html('<div class="no_con"></div>')}});var _screenPaper=$(".screenPaper").outerHeight(!0);null!==_screenPaper&&($(".tree-list").height($(window).height()-72-_screenPaper),$(".child-menu").height($(window).height()-72-_screenPaper),$(".child-content .child-menu").css({"padding-top":"0px"}),$(".child-content .content").height($(window).height()-72-_screenPaper).css("overflow-y","scroll"))},get_category:function(cnselectVal,element){return!1},add_question:function(qdata,index,unlock){$.tizi_ajax({url:baseUrlName+"paper/paper_question/add_question_to_paper",type:"POST",dataType:"json",data:qdata,success:function(data){unlock(),1==data.errorcode?($(".control-btn").eq(index).addClass("add-true"),$(".control-btn").eq(index).removeClass("add-false"),Teacher.paper.paper_common.randerCart(data.question_cart)):$.tiziDialog({content:data.error})}})},add_questions:function(qdata,index,unlock){$.tizi_ajax({url:baseUrlName+"paper/paper_question/add_questions_to_paper",type:"POST",dataType:"json",data:qdata,success:function(data){unlock(),1==data.errorcode?($(".add-false").addClass("add-true").removeClass("add-false"),Teacher.paper.paper_common.randerCart(data.question_cart)):(Teacher.paper.paper_common.randerCart(data.question_cart),Teacher.paper.paper_common.randerQuestion(),$.tiziDialog({content:data.error}))}})},remove_question:function(qidVal,sidVal,qorigin,index,unlock){$.tizi_ajax({url:baseUrlName+"paper/paper_question/remove_question_from_paper",type:"POST",dataType:"json",data:{qid:qidVal,sid:sidVal,qorigin:qorigin},success:function(data){unlock(),1==data.errorcode?($(".control-btn").eq(index).addClass("add-false"),$(".control-btn").eq(index).removeClass("add-true"),Teacher.paper.paper_common.randerCart(data.question_cart)):$.tiziDialog({content:data.error})}})},page:function(page){this.get_question(this.getUrlData(page))},paperFavorit:function(){$(".paperFavorit").live("click",function(){if($(this).toggleClass("paperFavoritClick"),$(this).hasClass("paperFavoritClick")){var cont='<form class="paperFavoritForm" action="#" method="post" onsubmit="return false;"><p>请选择分组：</p><div>初中语文&nbsp;&nbsp;<select><option>所有未分组</option></select></div></form>';$.tiziDialog({id:"paperFavoritHaveError",title:"将题目收藏到我的题库",content:cont,icon:null,width:400,ok:function(){return $(".paperFavoritForm").submit(),!1},cancel:!0,close:function(){}})}})},haveErrorUploadImages:function(){var that=this,fbupload=$(".haveErrorForm").find(".fbupload");fbupload.each(function(){var node=$(this),loading=staticUrlName+"image/answerquestion/loading.gif",upload_id=node.attr("id");$("#"+upload_id).uploadify({formData:$.tizi_token({session_id:$.cookies.get(baseSessID)},"post"),swf:staticBaseUrlName+staticVersion+"lib/uploadify/2.2/uploadify.swf",uploader:baseUrlName+"upload/feedback?id="+upload_id,multi:!1,buttonClass:"choseFileBtn",buttonText:"上传图片",fileTypeExts:"*.jpg; *.png;*.gif",fileSizeLimit:"2048KB",fileObjName:upload_id,button_image_url:baseUrlName+"quit",width:102,height:28,overrideEvents:["onSelectError","onDialogClose"],onUploadStart:function(){$(".haveErrorForm ."+upload_id).html('<img src="'+loading+'" class="imgloading"/>')},onSWFReady:function(){},onFallback:function(){$(".imgTips").html(noflash)},onSelectError:function(file,errorCode){switch(errorCode){case-110:$.tiziDialog({content:"文件 ["+file.name+"] 过大！每张图片不能超过2M"});break;case-120:$.tiziDialog({content:"文件 ["+file.name+"] 大小异常！不可以上传大小为0的文件"});break;case-130:$.tiziDialog({content:"文件 ["+file.name+"] 类型不正确！不可以上传错误的文件格式"})}return!1},onUploadSuccess:function(file,data){var json=JSON.parse(data),upload_id_img=$(".haveErrorForm ."+upload_id);if(1==json.code){var img_path=json.img_path;that.drawImage(img_path,92,71,upload_id),upload_id_img.removeClass("red"),upload_id_img.addClass("upladpicSpan").removeClass("upladpic")}else upload_id_img.html("<b>"+json.msg+"</b>"),upload_id_img.addClass("red");upload_id_img.siblings(".clearpic").show(),upload_id_img.siblings(".clearpic").on("click",function(){upload_id_img.find("img").remove(),upload_id_img.siblings(".clearpic").hide(),upload_id_img.removeClass("red"),upload_id_img.removeClass("upladpicSpan").addClass("upladpic")})},onUploadComplete:function(){}})})},drawImage:function(src,width,height,upload_id){var image=new Image,Img=new Image;image.src=src,image.onload=function(){image.width>width||image.height>height?(w=image.width/width,h=image.height/height,w>h?(Img.width=width,Img.height=image.height/w):(Img.height=height,Img.width=image.width/h)):(h=image.height/height,Img.width=image.width/h,Img.height=height),$(".haveErrorForm ."+upload_id).html('<img src="'+src+'" class="picture_urls" width="'+Img.width+'" height="'+Img.height+'"/>')}}};